#!/usr/bin/with-contenv bash
set -e

# Export all Docker Compose environment variables to SSH environment for user
USER_NAME="user"
ssh_dir="/home/${USER_NAME}/.ssh"
env_file="$ssh_dir/environment"

# Ensure .ssh directory exists
mkdir -p "$ssh_dir"

# Export all environment variables from Docker Compose to SSH environment
# Exclude problematic variables (HOME, PATH variants, system vars)
printenv | grep -v '^_' | grep -v '^SHLVL=' | grep -v '^PWD=' | grep -v '^HOME=' > "$env_file" || touch "$env_file"

# Set proper ownership and permissions
chown "${USER_NAME}:consultores_ext" "$env_file"
chmod 600 "$env_file"
